#!kivy 1.5

<MenuButton>:
    font_size: 10
    size_hint: (1, None)
    height: 20
#    width: 50
    group: 'tabs'
    text_size: self.width - 10, self.texture_size[1]
    texture_size: self.texture_size[0], self.height / 2 + 6
    valign: 'top'
    halign: 'center'
    shorten: True
    on_press:
        app._app_window.children[0].change_tab(self.text)
        self.state = 'down'

<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load This Tab"
                on_release: root.load(filechooser.path, filechooser.selection)

            Button:
                text: "Load All Tabs"
                on_release: root.load(filechooser.path, filechooser.selection)

<SaveDialog>:
    text_input: text_input
    save_all: save_all
    save_this: save_this

    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                id: save_this
                text: "Save This Tab"
                on_release: 
                    app.mainkvg.save(filechooser.path, text_input.text)

            Button:
                id: save_all
                text: "Save All Tabs"
                on_release: 
                    root.save(filechooser.path, text_input.text)




<MainKvG>:
    on_organicdrums_gain:
        self.mainmix.organicdrums.gainfader.value = args[1]



    target: app.config.get('OSC', 'dest_host') + ":" + str(app.config.get('OSC', 'dest_port'))

    container: container

    tunename: tunename

    sm: sm
    menu: menu

    mix_b: mix_b
    mainmix: mainmix

    odr_b: odr_b
    organicdrums: organicdrums

    bss_b: bss_b
    basses: basses

    gtr_b: gtr_b
    guitares: guitares

    sax_b: sax_b
    saxophones: saxophones

    vox_b: vox_b
    vocals: vocals

    mxs_b: mxs_b
    mxsynths: mxsynths

    mxd_b: mxd_b
    mxdrums: mxdrums

    fxs_b: fxs_b
    fxs: fxs

    mno_b: mno_b
    monitororl: monitororl

    mns_b: mns_b
    monitorsouv: monitorsouv

    mny_b: mny_b
    monitoryula: monitoryula

    mxb_b: mxb_b
    mxbass: mxbass

    mxc_b: mxc_b
    mxchords: mxchords

    mxl_b: mxl_b
    mxlead: mxlead

    mxd_b: mxd_b
    mxctlead: mxlead

    slo_b: slo_b
    sooperlooper: sooperlooper

    bfx_b: bfx_b
    bassfx: bassfx

    vfx_b: vfx_b
    vocalsfx: vocalsfx

    qlc_b: qlc_b
    qlc: qlc

    liv_b: liv_b
    lives: lives

    organicdrums_gain: self.organicdrums.organicdrums.gainfader.value

    BoxLayout:
        id: container
        orientation: 'vertical'
        size_hint: None, None
        pos: root.pos
        size: root.size

        BoxLayout:
            size_hint: 1, None
            height: 35
            orientation: 'horizontal'
            OscLabel:
                id: tunename
                text: "Sebkha-Chott Totalizm"
                size_hint: 1, 1
                font_size: 30

            Button:
                text: 'Save'
                size_hint: None, 1
                width: 80
                on_release:
                    root.save('./', root.sm.current.replace(" ", "_") + '.kvg')

            Button:
                text: 'Load'
                size_hint: None, 1
                width: 80
                on_release:
                    root.load('./', root.sm.current.replace(" ", "_") + '.kvg')

        Menu:
            id: menu
            orientation: 'horizontal'
            size_hint: (1, None)
            pos: root.x, root.y + root.height - self.height
            height: 30

            canvas.before:
                Color:
                    rgba: 0.2, 0.2, 0.2, 0.7
                Rectangle:
                    pos: self.pos
                    size: self.size

            MenuButton:
                id: mix_b
                text: "Main Mix"
                on_parent: self.state = 'down'

            MenuButton:
                id: odr_b
                text: "Organic Drums"

            MenuButton:
                id: bss_b
                text: "Basses"

            MenuButton:
                id: gtr_b
                text: "Guitares"

            MenuButton:
                id: sax_b
                text: "Saxophones"

            MenuButton:
                id: vox_b
                text: "Vocals"

            MenuButton:
                id: mxs_b
                text: "MxSynths"

            MenuButton:
                id: mxd_b
                text: "MxDrums"

            MenuButton:
                id: fxs_b
                text: "FXs"

            MenuButton:
                id: mno_b
                text: "Monitor ORL"

            MenuButton:
                id: mns_b
                text: "Monitor Souv"

            MenuButton:
                id: mny_b
                text: "Monitor Yula"

            MenuButton:
                id: mxb_b
                text: "MxBass"

            MenuButton:
                id: mxc_b
                text: "MxChords"

            MenuButton:
                id: mxl_b
                text: "MxLead"

            MenuButton:
                id: mxd_b
                text: "MxCtLead"

            MenuButton:
                id: slo_b
                text: "SooperLooper"

            MenuButton:
                id: bfx_b
                text: "Bass FX"

            MenuButton:
                id: vfx_b
                text: "Vocals FX"

            MenuButton:
                id: qlc_b
                text: "QLC"

            MenuButton:
                id: liv_b
                text: "Lives"

      
        ScreenManager:
            id: sm
            size_hint: (1, 1)

            MainMix:
                id: mainmix
                name: 'Main Mix'

            OrganicDrums:
                id: organicdrums
                name: 'Organic Drums'

            Basses:
                id: basses
                name: 'Basses'

            Guitares:
                id: guitares
                name: 'Guitares'

            Saxophones:
                id: saxophones
                name: 'Saxophones'                

            Vocals:
                id: vocals
                name: 'Vocals'

            MxSynths:
                id: mxsynths
                name: 'MxSynths'

            MxDrums:
                id: mxdrums
                name: 'MxDrums'

            Fxs:
                id: fxs
                name: 'FXs'

            MonitorOrl:
                id: monitororl
                name: 'Monitor ORL'

            MonitorSouv:
                id: monitorsouv
                name: 'Monitor Souv'

            MonitorYula:
                id: monitoryula
                name: 'Monitor Yula'

            MxBass:
                id: mxbass
                name: 'MxBass'

            MxChords:
                id: mxchords
                name: 'MxChords'

            MxLead:
                id: mxlead
                name: 'MxLead'

            MxCtLead:
                id: mxctlead
                name: 'MxCtLead'

            SooperLooper:
                id: sooperlooper
                name: 'SooperLooper'

            BassFx:
                id: bassfx
                name: 'Bass FX'

            VocalsFx:
                id: vocalsfx
                name: 'Vocals FX'

            Qlc:
                id: qlc
                name: 'QLC'

            Lives:
                id: lives
                name: "Lives"
            

<kvGhislame>:
    port: self.config.get('OSC', 'in_port')
    
